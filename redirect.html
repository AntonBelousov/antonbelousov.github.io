<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
  <title>Chattti</title>
  <script>
    const installPageLink = 'https://chattti-df15ecb715cc10d1bd516acf9d7f7c7.webflow.io/install'
    const appStoreLink = 'https://itunes.apple.com/app/id6446827017'

    const isIos = /iPad|iPhone|iPod/.test(navigator.userAgent)
    const to = new URLSearchParams(window.location.search).get('to')
    const url = new URL(installPageLink)
    url.searchParams.set('to', to)

    const redirect = () => {
      window.location.href = url.toString()
    }

    if (isIos) {
      // window.location.href = appStoreLink
      window.onload = () => {
        window.location = to
        // setTimeout(() => {
        //   window.location = appStoreLink
        // }, 100)
        document.getElementById('output').innerText = `to: ${to}`
      }
      
      window.onmessage = (event) => {
        document.getElementById('output').innerText = `Received message: ${event.data}`
      }
      window.onmessageerror = (event) => {
        document.getElementById('output').innerText = `Received onmessageerror: ${event.data}`
      }
    } else {
      redirect()
    }
  </script>
</head>

<body>
</body>
<div id="output">?</div>
</html>
