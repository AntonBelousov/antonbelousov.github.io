<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
  <title>Chattti</title>
  <script>
    const installPageLink = 'https://chattti-df15ecb715cc10d1bd516acf9d7f7c7.webflow.io/install'
    const appStoreLink = 'https://itunes.apple.com/app/id6446827017'

    const isIos = /iPad|iPhone|iPod/.test(navigator.userAgent)
    const to = new URLSearchParams(window.location.search).get('to')
    const url = new URL(installPageLink)
    url.searchParams.set('to', to)

    const redirect = () => {
      window.location.href = url.toString()
    }

    if (isIos) {
      window.onload = () => {
        // window.location = to
        // setTimeout(redirect, 100)
        document.getElementById('output').innerText = navigator.userAgent
        const userAgent = navigator.userAgent
        if (
          (/CriOS/).test(userAgent) ||
          (/FxiOS/).test(userAgent) ||
          (/OPT/).test(userAgent) ||
          (/OPX/).test(userAgent) || 
          (/Ddg/).test(userAgent) ||
          (/YaBrowser/).test(userAgent) ||
          (/EdgiOS/).test(userAgent) ||
          (/AlohaBrowser/).test(userAgent)
          ){
          // is probably Safari          
            document.getElementById('isSafari').innerText = "is probably Safari"
            window.location = to
            setTimeout(() => {
              window.location = appStoreLink
            }, 100)
          } else {
          // is not Safari
            document.getElementById('isSafari').innerText = "is not Safari"
            window.location = to
            setTimeout(redirect, 100)
          }
      }
    } else {
      redirect()
    }
  </script>
</head>

<body>
</body>
<div id="output">11</div>
<div id="isSafari">12</div>
</html>
